# 体系结构实验2

## 题目分析

本实验要求实现多个分支预测器的软件模型并使用 Pin 工具分析这些模型在实际情况下的表现。

### 基于 BHT 的分支预测

BHT 预测器结构简单，易于实现，使用资源少，而且实际表现也不错，对大多数的 workload 其预测准确率都在 90% 以上。BHT 直接取地址中的部分位作为 Branch History Table 的索引，取出一个 2 bit 饱和计数器并将其预测结果作为整个预测器的结果输出。BHT 使用时钟周期一般为 1。

![img](lab2.assets/3-1.png)

类似于 Cache 的直接映射缓存，BHT 直接取地址的位作为表的索引，这种做法可能会因 Tag 冲突造成一个饱和计数器对应于多个地址的跳转，从而使得饱和计数器可能抖动降低 BHT 预测器整体的表现。

同时，BHT 忽视了分支指令之间的关联性，仅关注指令地址，从而降低了其描述性。

### 基于全局历史的分支预测

为了关注分支指令之间的关联性，基于全局历史的分支预测在 BHT 基础上添加了 GHR 全局历史寄存器来将所有的分支指令关联起来。

![img](lab2.assets/3-4.png)

通过添加 GHR，实现了将相同地址、不同轨迹的跳转情况对应到不同的饱和计数器，提高了模型的描述性和性能。

### 锦标赛分支预测器

锦标赛分支预测（又称混合分支预测或组合分支预测）是一种博采众长的分支预测方法，其基本原理是将两个或以上的分支预测方法进行结合，充分发挥各预测方法的优势，以进一步提高分支预测的准确度。

![img](lab2.assets/3-6.png)

其基本逻辑是通过饱和计数器控制该选择哪一个子预测器的预测结果，不断选择正确率较高的那一个。

### TAGE 分支预测器

TAGE 分支预测器通过比较复杂的结构和逻辑完成了对以上几种结构的综合和超越。

![img](lab2.assets/3-8.png)

其基本思想有：

1. 吸收 BHT 分支预测结构经验，将饱和计数器作为最小的预测单元
2. 类似锦标赛分支预测器，每次分支预测都选择一个子分支预测器的结果，并通过 `usefulness` 不断调整子分支预测器之间的优先级
3. 类似全局历史分支预测器，将待预测的地址首先进行一次哈希操作再去查表，考虑全局的情况
4. 添加了 Tag 字段，判断第二次哈希后是否 Tag 匹配，减少了不同地址使用到同一个 `entry` 的碰撞情况
5. 使用定时复位权值的方法，防止一直使用某个子预测器的预测值

## 设计与实现

### 方案设计

### 试验结果以及分析

